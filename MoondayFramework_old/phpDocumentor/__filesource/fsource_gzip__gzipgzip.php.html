<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>File Source for gzip.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
		</head>
		<body>
						<h1>Source for file gzip.php</h1>
<p>Documentation is available at <a href="../gzip/_gzip_gzip_php.html">gzip.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a><span class="src-doc">/**</span></li>
<li><a name="a3"></a><span class="src-doc">* </span><span class="src-doc-coretag">@package</span><span class="src-doc"> gzip</span></li>
<li><a name="a4"></a><span class="src-doc">* </span><span class="src-doc-coretag">@author</span><span class="src-doc"> Joshua Abbott, WiseGene Project (NKommunikation)</span></li>
<li><a name="a5"></a><span class="src-doc">* </span><span class="src-doc-coretag">@copyright</span><span class="src-doc"> (C) 2006 NKommunikation. All Rights Reserved.</span></li>
<li><a name="a6"></a><span class="src-doc">* </span><span class="src-doc-tag">@desc</span><span class="src-doc"> gzip file format</span></li>
<li><a name="a7"></a><span class="src-doc">* </span><span class="src-doc-coretag">@uses</span></li>
<li><a name="a8"></a><span class="src-doc">* </span><span class="src-doc-coretag">@example</span></li>
<li><a name="a9"></a><span class="src-doc">* </span><span class="src-doc-tag">@files</span></li>
<li><a name="a10"></a><span class="src-doc">*/</span></li>
<li><a name="a11"></a>&nbsp;</li>
<li><a name="a12"></a><a href="http://www.php.net/define">define</a><span class="src-sym">(</span><span class="src-str">&quot;_GZIP&quot;</span><span class="src-sym">,</span><span class="src-id">true</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a13"></a><a href="http://www.php.net/define">define</a><span class="src-sym">(</span><span class="src-str">&quot;_GZIP_VER&quot;</span><span class="src-sym">, </span><span class="src-num">1.3</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a14"></a><a href="http://www.php.net/define">define</a><span class="src-sym">(</span><span class="src-str">&quot;_GZIP_BUILD&quot;</span><span class="src-sym">, </span><span class="src-str">'03.04.2002'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a15"></a>&nbsp;</li>
<li><a name="a16"></a>&nbsp;</li>
<li><a name="a17"></a><span class="src-comm">###################################################################################</span></li>
<li><a name="a18"></a><span class="src-key">class </span><a href="../gzip/gzip.html">gzip</a> <span class="src-sym">{</span></li>
<li><a name="a19"></a>&nbsp;</li>
<li><a name="a20"></a>  <span class="src-comm"># Array to store compressed data</span></li>
<li><a name="a21"></a>  <span class="src-comm"># private string[]</span></li>
<li><a name="a21"></a>  </li>
<li><a name="a22"></a>  <span class="src-key">var </span><span class="src-var">$_datasec </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a23"></a>&nbsp;</li>
<li><a name="a24"></a>&nbsp;</li>
<li><a name="a25"></a>  <span class="src-comm"># ���������� ���������� ����.</span></li>
<li><a name="a26"></a>  <span class="src-comm"># public boolean</span></li>
<li><a name="a26"></a>  </li>
<li><a name="a27"></a>  <span class="src-key">var </span><a href="../gzip/gzip.html#var$debug">$debug</a> = <span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a28"></a>&nbsp;</li>
<li><a name="a29"></a>&nbsp;</li>
<li><a name="a30"></a>  <span class="src-doc">/****************************************************************************</span></li>
<li><a name="a31"></a><span class="src-doc">  * ����������� ������</span></li>
<li><a name="a32"></a><span class="src-doc">  * public void</span></li>
<li><a name="a33"></a><span class="src-doc">  */</span></li>
<li><a name="a34"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodgzip">gzip</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a35"></a>  <span class="src-sym">}</span></li>
<li><a name="a36"></a>&nbsp;</li>
<li><a name="a37"></a>&nbsp;</li>
<li><a name="a38"></a>&nbsp;</li>
<li><a name="a39"></a>  <span class="src-doc">/****************************************************************************</span></li>
<li><a name="a40"></a><span class="src-doc">  * Adds &quot;file content&quot; to archive</span></li>
<li><a name="a41"></a><span class="src-doc">  *</span></li>
<li><a name="a42"></a><span class="src-doc">  * public void</span></li>
<li><a name="a43"></a><span class="src-doc">  * string @data - file contents</span></li>
<li><a name="a44"></a><span class="src-doc">  * string @name - name of the file in the archive (may contains the path)</span></li>
<li><a name="a45"></a><span class="src-doc">  */</span></li>
<li><a name="a46"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodadd">add</a><span class="src-sym">(</span><span class="src-var">$data</span><span class="src-sym">, </span><span class="src-var">$name</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a47"></a>    <span class="src-var">$unc_len </span>= <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$data</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a48"></a>    <span class="src-var">$crc     </span>= <a href="http://www.php.net/crc32">crc32</a><span class="src-sym">(</span><span class="src-var">$data</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a49"></a>    <span class="src-var">$zdata </span>= <a href="http://www.php.net/gzdeflate">gzdeflate</a><span class="src-sym">(</span><span class="src-var">$data</span><span class="src-sym">,</span><span class="src-num">9</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a50"></a>    <span class="src-var">$c_len </span>= <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$zdata</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a51"></a>&nbsp;</li>
<li><a name="a52"></a>    <span class="src-var">$fr</span>=</li>
<li><a name="a53"></a>      <span class="src-str">&quot;\x1f&quot;</span>.                    <span class="src-comm"># ID1                              1</span></li>
<li><a name="a54"></a>      <span class="src-str">&quot;\x8B&quot;</span>.                    <span class="src-comm"># ID2                              1</span></li>
<li><a name="a55"></a>      <span class="src-str">&quot;\x08&quot;</span>.                    <span class="src-comm"># Compression Method &quot;deflate&quot;     1</span></li>
<li><a name="a56"></a>      <span class="src-str">&quot;\x08&quot;</span>.                    <span class="src-comm"># FLaGs &quot;FNAME&quot;                    1</span></li>
<li><a name="a57"></a>      <span class="src-str">&quot;\x00\x00\x00\x00&quot;</span>.        <span class="src-comm"># last mod time &amp; date             4</span></li>
<li><a name="a58"></a>      <span class="src-str">&quot;\x00&quot;</span>.                    <span class="src-comm"># eXtra FLags &quot;2&quot;-max &quot;4&quot;-fast     1</span></li>
<li><a name="a59"></a>      <span class="src-str">&quot;\x00&quot;</span>.                    <span class="src-comm"># OS &quot;\x00&quot; - FAT                  1</span></li>
<li><a name="a60"></a>      <span class="src-var">$name</span>.                     <span class="src-comm"># orig. file name                var</span></li>
<li><a name="a61"></a>      <span class="src-str">&quot;\x00&quot;</span>.                    <span class="src-comm"># zero term.                       1</span></li>
<li><a name="a62"></a>      <span class="src-var">$zdata</span>.</li>
<li><a name="a63"></a>      <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_pack</span><span class="src-sym">(</span><span class="src-var">$crc</span><span class="src-sym">, </span><span class="src-num">4</span><span class="src-sym">)</span>.      <span class="src-comm"># crc32                           4</span></li>
<li><a name="a64"></a>      <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_pack</span><span class="src-sym">(</span><span class="src-var">$unc_len</span><span class="src-sym">, </span><span class="src-num">4</span><span class="src-sym">)</span><span class="src-sym">;  </span><span class="src-comm"># uncompressed filesize           4</span></li>
<li><a name="a65"></a>&nbsp;</li>
<li><a name="a66"></a>&nbsp;</li>
<li><a name="a67"></a>    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_datasec</span><span class="src-sym">[</span><span class="src-sym">] </span>= <span class="src-var">$fr</span><span class="src-sym">;</span></li>
<li><a name="a68"></a>  <span class="src-sym">}</span></li>
<li><a name="a69"></a>&nbsp;</li>
<li><a name="a70"></a>&nbsp;</li>
<li><a name="a71"></a>&nbsp;</li>
<li><a name="a72"></a>&nbsp;</li>
<li><a name="a73"></a>  <span class="src-doc">/******************************************************************************</span></li>
<li><a name="a74"></a><span class="src-doc">  * ������������� ���������� ������</span></li>
<li><a name="a75"></a><span class="src-doc">  * public object</span></li>
<li><a name="a76"></a><span class="src-doc">  */</span></li>
<li><a name="a77"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodextract">extract</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a78"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">))</span><span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a79"></a>    <span class="src-var">$fd </span>= <a href="http://www.php.net/fopen">fopen</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">,</span><span class="src-str">'rb'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a80"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">! </span><span class="src-var">$content </span>= <a href="http://www.php.net/fread">fread</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">, </span><a href="http://www.php.net/filesize">filesize</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)) ) </span><span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a81"></a>    <span class="src-sym">@</span><a href="http://www.php.net/fclose">fclose</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a82"></a>&nbsp;</li>
<li><a name="a83"></a>&nbsp;</li>
<li><a name="a84"></a>    <span class="src-var">$ret </span>= <span class="src-key">new </span><span class="src-id">stdClass</span><span class="src-sym">;</span></li>
<li><a name="a85"></a>&nbsp;</li>
<li><a name="a86"></a>    <span class="src-comm"># ������ ��� ������������� �����������</span></li>
<li><a name="a87"></a>    <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a88"></a>&nbsp;</li>
<li><a name="a89"></a>&nbsp;</li>
<li><a name="a90"></a>&nbsp;</li>
<li><a name="a91"></a>&nbsp;</li>
<li><a name="a92"></a>    <span class="src-comm"># ��������� ������� ������</span></li>
<li><a name="a93"></a>    <span class="src-var">$pointer</span>=<span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a94"></a>    <span class="src-comm"># ����� �����</span></li>
<li><a name="a95"></a>    <span class="src-var">$fpointer </span>= <span class="src-num">0</span><span class="src-sym">;</span></li>
<li><a name="a96"></a>    <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a97"></a>&nbsp;</li>
<li><a name="a98"></a>&nbsp;</li>
<li><a name="a99"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-str">&quot;\x1f\x8b&quot; </span>!= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">) )</span><span class="src-sym">{</span></li>
<li><a name="a100"></a>      <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_debug</span><span class="src-sym">(</span><span class="src-str">&quot;It's not .gzip format&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a101"></a>      <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a102"></a>    <span class="src-sym">}</span></li>
<li><a name="a103"></a>    <span class="src-var">$pointer</span>+=<span class="src-num">2</span><span class="src-sym">;</span></li>
<li><a name="a104"></a>&nbsp;</li>
<li><a name="a105"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-str">&quot;\x08&quot; </span>!= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">) )</span><span class="src-sym">{</span></li>
<li><a name="a106"></a>      <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_debug</span><span class="src-sym">(</span><span class="src-str">&quot;Compression method must be 'deflate'&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a107"></a>      <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a108"></a>    <span class="src-sym">}</span></li>
<li><a name="a109"></a>    <span class="src-var">$pointer</span>++<span class="src-sym">;</span></li>
<li><a name="a110"></a>&nbsp;</li>
<li><a name="a111"></a>&nbsp;</li>
<li><a name="a112"></a>    <span class="src-comm"># This flag byte is divided into individual bits as follows: </span></li>
<li><a name="a113"></a>    <span class="src-comm"># bit 0   FTEXT</span></li>
<li><a name="a114"></a>    <span class="src-comm"># bit 1   FHCRC</span></li>
<li><a name="a115"></a>    <span class="src-comm"># bit 2   FEXTRA</span></li>
<li><a name="a116"></a>    <span class="src-comm"># bit 3   FNAME</span></li>
<li><a name="a117"></a>    <span class="src-comm"># bit 4   FCOMMENT</span></li>
<li><a name="a118"></a>    <span class="src-key">switch</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">) )</span><span class="src-sym">{</span></li>
<li><a name="a119"></a>      <span class="src-comm">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></li>
<li><a name="a120"></a>      <span class="src-comm"># FNAME</span></li>
<li><a name="a121"></a>      <span class="src-key">case </span><span class="src-str">&quot;\x08&quot;</span>:</li>
<li><a name="a122"></a>&nbsp;</li>
<li><a name="a123"></a>        <span class="src-var">$pointer</span>++<span class="src-sym">;</span></li>
<li><a name="a124"></a>&nbsp;</li>
<li><a name="a125"></a>        <span class="src-comm"># Modification time</span></li>
<li><a name="a126"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'mod_time'</span><span class="src-sym">] </span>=</li>
<li><a name="a127"></a>          <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a128"></a>        <span class="src-var">$pointer</span>+=<span class="src-num">2</span><span class="src-sym">;</span></li>
<li><a name="a129"></a>&nbsp;</li>
<li><a name="a130"></a>        <span class="src-comm"># Modification date</span></li>
<li><a name="a131"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'mod_date'</span><span class="src-sym">] </span>=</li>
<li><a name="a132"></a>          <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">2</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a133"></a>        <span class="src-var">$pointer</span>+=<span class="src-num">2</span><span class="src-sym">;</span></li>
<li><a name="a134"></a>&nbsp;</li>
<li><a name="a135"></a>        <span class="src-comm"># eXtra FLags</span></li>
<li><a name="a136"></a>        <span class="src-comm"># 2 - compressor used maximum compression, slowest algorithm</span></li>
<li><a name="a137"></a>        <span class="src-comm"># 4 - compressor used fastest algorithm</span></li>
<li><a name="a138"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'xfl'</span><span class="src-sym">] </span>=</li>
<li><a name="a139"></a>          <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a140"></a>        <span class="src-var">$pointer</span>++<span class="src-sym">;</span></li>
<li><a name="a141"></a>&nbsp;</li>
<li><a name="a142"></a>        <span class="src-comm"># Operating System</span></li>
<li><a name="a143"></a>        <span class="src-comm"># 0 - FAT filesystem (MS-DOS, OS/2, NT/Win32)</span></li>
<li><a name="a144"></a>        <span class="src-comm"># 3 - Unix</span></li>
<li><a name="a145"></a>        <span class="src-comm"># 7 - Macintosh</span></li>
<li><a name="a146"></a>        <span class="src-comm"># 11 - NTFS filesystem (NT)</span></li>
<li><a name="a147"></a>        <span class="src-comm"># 255 - unknown</span></li>
<li><a name="a148"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'os'</span><span class="src-sym">] </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a149"></a>        <span class="src-var">$pointer</span>++<span class="src-sym">;</span></li>
<li><a name="a150"></a>&nbsp;</li>
<li><a name="a151"></a>        <span class="src-comm">#file name</span></li>
<li><a name="a152"></a>        <span class="src-key">for</span><span class="src-sym">(</span><span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'file_name'</span><span class="src-sym">]</span>=<span class="src-str">&quot;&quot;</span><span class="src-sym">; </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">) </span>!= <span class="src-str">&quot;\x00&quot;</span><span class="src-sym">; </span><span class="src-var">$pointer</span>++<span class="src-sym">)</span></li>
<li><a name="a153"></a>          <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'file_name'</span><span class="src-sym">] </span>.= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a154"></a>        <span class="src-var">$pointer</span>++<span class="src-sym">;</span></li>
<li><a name="a155"></a>&nbsp;</li>
<li><a name="a156"></a>        <span class="src-comm"># compressed blocks...</span></li>
<li><a name="a157"></a>        <span class="src-var">$zdata </span>= <a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">, </span>-<span class="src-num">8</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>        <span class="src-var">$pointer </span>= <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">) </span>- <span class="src-num">8</span><span class="src-sym">;</span></li>
<li><a name="a159"></a>&nbsp;</li>
<li><a name="a160"></a>        <span class="src-comm"># Cyclic Redundancy Check</span></li>
<li><a name="a161"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'crc32'</span><span class="src-sym">] </span>=</li>
<li><a name="a162"></a>          <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">4</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a163"></a>        <span class="src-var">$pointer</span>+=<span class="src-num">4</span><span class="src-sym">;</span></li>
<li><a name="a164"></a>&nbsp;</li>
<li><a name="a165"></a>        <span class="src-comm"># size of the original (uncompressed) input data modulo 2^32</span></li>
<li><a name="a166"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">head</span><span class="src-sym">[</span><span class="src-str">'uncompressed_filesize'</span><span class="src-sym">] </span>=</li>
<li><a name="a167"></a>          <span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">_unpack</span><span class="src-sym">( </span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">, </span><span class="src-var">$pointer</span><span class="src-sym">,</span><span class="src-num">4</span><span class="src-sym">) )</span><span class="src-sym">;</span></li>
<li><a name="a168"></a>        <span class="src-var">$pointer</span>+=<span class="src-num">4</span><span class="src-sym">;</span></li>
<li><a name="a169"></a>&nbsp;</li>
<li><a name="a170"></a>&nbsp;</li>
<li><a name="a171"></a>        <span class="src-comm"># decompress data and store it at array</span></li>
<li><a name="a172"></a>        <span class="src-var">$ret</span><span class="src-sym">-&gt;</span><span class="src-id">part</span><span class="src-sym">[</span><span class="src-var">$fpointer</span><span class="src-sym">]</span><span class="src-sym">-&gt;</span><span class="src-id">body </span>= <a href="http://www.php.net/gzinflate">gzinflate</a><span class="src-sym">(</span><span class="src-var">$zdata</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a173"></a>&nbsp;</li>
<li><a name="a174"></a>        <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a175"></a>&nbsp;</li>
<li><a name="a176"></a>&nbsp;</li>
<li><a name="a177"></a>      <span class="src-comm">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></li>
<li><a name="a178"></a>      <span class="src-key">default</span>:</li>
<li><a name="a179"></a>        <span class="src-key">return </span><span class="src-id">null</span><span class="src-sym">;</span></li>
<li><a name="a180"></a>&nbsp;</li>
<li><a name="a181"></a>    <span class="src-sym">}</span><span class="src-comm">#switch</span></li>
<li><a name="a182"></a>&nbsp;</li>
<li><a name="a183"></a>    <span class="src-key">return </span><span class="src-var">$ret</span><span class="src-sym">;</span></li>
<li><a name="a184"></a>  <span class="src-sym">}</span></li>
<li><a name="a185"></a>&nbsp;</li>
<li><a name="a186"></a>&nbsp;</li>
<li><a name="a187"></a>&nbsp;</li>
<li><a name="a188"></a>&nbsp;</li>
<li><a name="a189"></a>&nbsp;</li>
<li><a name="a190"></a>&nbsp;</li>
<li><a name="a191"></a>&nbsp;</li>
<li><a name="a192"></a>&nbsp;</li>
<li><a name="a193"></a>&nbsp;</li>
<li><a name="a194"></a>  <span class="src-doc">/****************************************************************************</span></li>
<li><a name="a195"></a><span class="src-doc">  * Dumps out file</span></li>
<li><a name="a196"></a><span class="src-doc">  *</span></li>
<li><a name="a197"></a><span class="src-doc">  * public string - the gzipped file</span></li>
<li><a name="a198"></a><span class="src-doc">  */</span></li>
<li><a name="a199"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodfile">file</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a200"></a>    <span class="src-var">$data </span>= <a href="http://www.php.net/implode">implode</a><span class="src-sym">(</span><span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_datasec</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a201"></a>    <span class="src-key">return </span><span class="src-var">$data</span><span class="src-sym">;</span></li>
<li><a name="a202"></a>  <span class="src-sym">}</span></li>
<li><a name="a203"></a>&nbsp;</li>
<li><a name="a204"></a>&nbsp;</li>
<li><a name="a205"></a>&nbsp;</li>
<li><a name="a206"></a>&nbsp;</li>
<li><a name="a207"></a>  <span class="src-doc">/****************************************************************************</span></li>
<li><a name="a208"></a><span class="src-doc">  * print error message</span></li>
<li><a name="a209"></a><span class="src-doc">  * public void</span></li>
<li><a name="a210"></a><span class="src-doc">  */</span></li>
<li><a name="a211"></a>  <span class="src-key">function </span><span class="src-id">_debug</span><span class="src-sym">(</span><span class="src-var">$str</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a212"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../gzip/gzip.html#var$debug">debug</a><span class="src-sym">) </span>echo <span class="src-var">$str</span><span class="src-sym">;</span></li>
<li><a name="a213"></a>  <span class="src-sym">}</span></li>
<li><a name="a214"></a>&nbsp;</li>
<li><a name="a215"></a>&nbsp;</li>
<li><a name="a216"></a>&nbsp;</li>
<li><a name="a217"></a>&nbsp;</li>
<li><a name="a218"></a>  <span class="src-doc">/******************************************************************************</span></li>
<li><a name="a219"></a><span class="src-doc">  * pack data into binary string</span></li>
<li><a name="a220"></a><span class="src-doc">  * private string</span></li>
<li><a name="a221"></a><span class="src-doc">  */</span></li>
<li><a name="a222"></a>  <span class="src-key">function </span><span class="src-id">_pack</span><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">, </span><span class="src-var">$bytes</span>=<span class="src-num">2</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a223"></a>    <span class="src-key">for</span><span class="src-sym">(</span><span class="src-var">$ret</span>=<span class="src-str">''</span><span class="src-sym">, </span><span class="src-var">$i</span>=<span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i</span>&lt;<span class="src-var">$bytes</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">, </span><span class="src-var">$val</span>=<a href="http://www.php.net/floor">floor</a><span class="src-sym">(</span><span class="src-var">$val</span>/<span class="src-num">256</span><span class="src-sym">) )</span></li>
<li><a name="a224"></a>      <span class="src-var">$ret </span>.= <a href="http://www.php.net/chr">chr</a><span class="src-sym">(</span><span class="src-var">$val </span>% <span class="src-num">256</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a225"></a>    <span class="src-key">return </span><span class="src-var">$ret</span><span class="src-sym">;</span></li>
<li><a name="a226"></a>  <span class="src-sym">}</span></li>
<li><a name="a227"></a>&nbsp;</li>
<li><a name="a228"></a>&nbsp;</li>
<li><a name="a229"></a>  <span class="src-doc">/******************************************************************************</span></li>
<li><a name="a230"></a><span class="src-doc">  * unpack data from binary string</span></li>
<li><a name="a231"></a><span class="src-doc">  * private string</span></li>
<li><a name="a232"></a><span class="src-doc">  */</span></li>
<li><a name="a233"></a>  <span class="src-key">function </span><span class="src-id">_unpack</span><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a234"></a>    <span class="src-key">for</span><span class="src-sym">(</span><span class="src-var">$len </span>= <a href="http://www.php.net/strlen">strlen</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-var">$ret</span>=<span class="src-num">0</span><span class="src-sym">, </span><span class="src-var">$i</span>=<span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$len</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">)</span></li>
<li><a name="a235"></a>      <span class="src-var">$ret </span>+= (int)<a href="http://www.php.net/ord">ord</a><span class="src-sym">(</span><a href="http://www.php.net/substr">substr</a><span class="src-sym">(</span><span class="src-var">$val</span><span class="src-sym">,</span><span class="src-var">$i</span><span class="src-sym">,</span><span class="src-num">1</span><span class="src-sym">)) </span>* <a href="http://www.php.net/pow">pow</a><span class="src-sym">(</span><span class="src-num">2</span><span class="src-sym">, </span><span class="src-num">8 </span>* <span class="src-var">$i</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a236"></a>    <span class="src-key">return </span><span class="src-var">$ret</span><span class="src-sym">;</span></li>
<li><a name="a237"></a>  <span class="src-sym">}</span></li>
<li><a name="a238"></a>&nbsp;</li>
<li><a name="a239"></a>&nbsp;</li>
<li><a name="a240"></a>&nbsp;</li>
<li><a name="a241"></a>  <span class="src-doc">/******************************************************************************</span></li>
<li><a name="a242"></a><span class="src-doc">  * ��������� ���������� ����� � �����</span></li>
<li><a name="a243"></a><span class="src-doc">  * public boolean</span></li>
<li><a name="a244"></a><span class="src-doc">  */</span></li>
<li><a name="a245"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodadd_file">add_file</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">, </span><span class="src-var">$binary</span>=<span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a246"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">!</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">))</span><span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a247"></a>    <span class="src-var">$fd </span>= <span class="src-var">$binary</span>? <a href="http://www.php.net/fopen">fopen</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">,</span><span class="src-str">'rb'</span><span class="src-sym">) </span>: <a href="http://www.php.net/fopen">fopen</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">,</span><span class="src-str">'r'</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a248"></a>    <span class="src-key">if</span><span class="src-sym">(</span><span class="src-sym">! </span><span class="src-var">$content </span>= <a href="http://www.php.net/fread">fread</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">, </span><a href="http://www.php.net/filesize">filesize</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)) )</span><span class="src-key">return </span><span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a249"></a>    <a href="http://www.php.net/fclose">fclose</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a250"></a>&nbsp;</li>
<li><a name="a251"></a>    <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../gzip/gzip.html#methodadd">add</a><span class="src-sym">(</span><span class="src-var">$content</span><span class="src-sym">,</span><span class="src-var">$name</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a252"></a>    <span class="src-key">return </span><span class="src-id">true</span><span class="src-sym">;</span></li>
<li><a name="a253"></a>  <span class="src-sym">}</span></li>
<li><a name="a254"></a>&nbsp;</li>
<li><a name="a255"></a>&nbsp;</li>
<li><a name="a256"></a>  <span class="src-doc">/******************************************************************************</span></li>
<li><a name="a257"></a><span class="src-doc">  * ������ .zip �����</span></li>
<li><a name="a258"></a><span class="src-doc">  * public int</span></li>
<li><a name="a259"></a><span class="src-doc">  */</span></li>
<li><a name="a260"></a>  <span class="src-key">function </span><a href="../gzip/gzip.html#methodwrite_file">write_file</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a261"></a>    <span class="src-var">$size </span>= -<span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a262"></a>    <span class="src-key">if</span><span class="src-sym">( </span><span class="src-var">$fd</span>=<a href="http://www.php.net/fopen">fopen</a><span class="src-sym">(</span><span class="src-var">$name</span><span class="src-sym">,</span><span class="src-str">'wb'</span><span class="src-sym">) )</span><span class="src-sym">{</span></li>
<li><a name="a263"></a>      <span class="src-var">$size </span>= <a href="http://www.php.net/fwrite">fwrite</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">,</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../gzip/gzip.html#methodfile">file</a><span class="src-sym">(</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a264"></a>      <a href="http://www.php.net/fclose">fclose</a><span class="src-sym">(</span><span class="src-var">$fd</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a265"></a>    <span class="src-sym">}</span></li>
<li><a name="a266"></a>    <span class="src-key">return </span><span class="src-var">$size</span><span class="src-sym">;</span></li>
<li><a name="a267"></a>  <span class="src-sym">}</span></li>
<li><a name="a268"></a>&nbsp;</li>
<li><a name="a269"></a>&nbsp;</li>
<li><a name="a270"></a><span class="src-sym">}</span><span class="src-comm">#class</span></li>
<li><a name="a271"></a><span class="src-comm">###################################################################################</span></li>
<li><a name="a271"></a>&nbsp;</li>
<li><a name="a272"></a><span class="src-php">?&gt;</span></li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Mon, 19 Jul 2010 20:33:59 -0500 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC3</a>
	</p>
	</body>
</html>